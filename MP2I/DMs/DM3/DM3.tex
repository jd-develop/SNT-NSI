\input{Latex.Settings.tex}

\title{DM3: Conception et utilisation d’un SAT-solver}
\author{}
\date{}

\begin{document}
    \maketitle
    \section{Conception du SAT-solver}
    \subsection*{Q10.}
    Soit $n$ le nombre d'opérateur.
    
    Dans la configuration $(...((a_0 | a_1) | a_2) | ...) | a_n$,
    il y a bien $n$ opérateur.
    
    De plus, la complexité de l'algorithme dans cette configuration est
    \begin{align*}
        C_n &= C_{n-1} + C_0 + \Theta(n)\\
        &\geq C_{n-1} + nA\\
        &\geq C_0 + \sum_{i=0}^{n-1}(n-i)A\\
        C_n &= \boxed{\Omega(n^2)}\\
    \end{align*}
    Donc dans le pire cas, la complexité est au moins en $\Omega(n^2)$.
    
    Pour améliorer la fonction
    il faut passer par une variable intermédiaire puis trier la liste.
    
    \subsection*{Q11.(Bonus)}
    Dans la nouvelle fonction, on a
    \begin{align*}
        C_n &= \Theta(n) + \Theta(n\log(n))\\
        C_n &= \boxed{\Theta(n\log(n))}\\
    \end{align*}
    
    \subsection*{Q19.}
    Dans la configuration $\sim(...(\sim T)...)$, 
    la complexité de l'algorithme dans cette configuration est
    \begin{align*}
        C_n &= C_{n-2} + \Theta(n)\\
        C_n &= \boxed{\Theta(n^2)}\\
    \end{align*}
    
    \subsection*{Q20.(Bonus)}
    Dans la nouvelle fonction, on simplifie les enfants avant le noeud.
    
    La complexité est
    \begin{align*}
        C_n &= C_{i} + C_{n-1-i} + \Theta(1), \quad i \in \dsbracket{0,n-1}\\
        C_n &= \boxed{\Theta(n)}\\
    \end{align*}
    
    \subsection*{Q25.}~
    
    \subsection*{Q26.(Bonus)}
    Le satsolver spécialiser en FNC a été implémenter dans "fnc\_solver.ml".
    De plus, la propagation unitaire a été rajouter.
    
    En terme d'efficacité, le satsolver en FNC est meilleur que le simple.
    En effet, dans la résolution du problème a n dames (voir $2^{nd}$ partie),
    le satsolver en FNC permet de résoudre plus de dames et en moins de temps.
    
    \section{Résolution de problèmes}
    \subsection*{Q31.}
    La formule
    $\boxed{\bigwedge\limits_{1 \leq i < j \leq n}\left(\lnot a_i \lor \lnot a_j\right)}$
    est sous FNC.
    
    Pour $n$ variables différentes, la formule contient $\frac{n(n-1)}{2}$ variables.
    
    \subsection*{Q38.}
    La taille de la formule de "gen\_formule\_n\_dames" est
    \begin{align*}
        C_n &= C_{ligne}(n) + C_{col}(n) + C_{diag}(n) + \Theta(1)\\
        &= nE_x(n) + nE_p(n) + 2\sum_{i=-n+2}^{n-2}E_p(|n-i|) + \Theta(n)\\
    \end{align*}
    
    Avec $E_x$ la fonction "exactement\_une" et $E_p$ "au\_plus\_une".
    
    Or $nE_x(n) = \Theta(n^3)$, $nE_p(n) = \Theta(n^3)$ et
    $2\sum_{i=-n+2}^{n-2}E_p(|n-i|) \leq 4nE_p(n) = O(n^3)$,
    
    \begin{align*}
        C_n &= \Theta(n^3) + \Theta(n^3) + O(n^3) +\Theta(n)\\
        C_n &= \boxed{O(n^3)}\\
    \end{align*}
    
    \subsection*{Q40.}
    Pour le problème a 5 dames, on obtient
    \begin{lstlisting}
~/DM3$ problemes/n_dames 5
Fichier '5_dames.txt' §généré§.
Taille du fichier : 3471 octets.
~/DM3$ satsolver/fnc_solver 5_dames.txt
La formule est sous FNC.
La formule est satisfiable en assignant 1 aux variables suivantes et 0 aux autres :
X_0_4
X_1_2
X_2_0
X_3_3
X_4_1
Temps d'ex§é§cution : 0.001377 s
    \end{lstlisting}
    Soit encore
    \begin{center}
        \begin{tabular}{| c || *{5}{c |}}
        \hline
          & 0 & 1 & 2 & 3 & 4 \\
        \hline
        \hline
        0 &   &   & X &   &   \\
        \hline
        1 &   &   &   &   & X \\
        \hline
        2 &   & X &   &   &   \\
        \hline
        3 &   &   &   & X &   \\
        \hline
        4 & X &   &   &   &   \\
        \hline
        \end{tabular}
    \end{center}
    
    Pour le problème a 8 dames, on obtient
    \begin{lstlisting}
~/DM3$ satsolver/fnc_solver 8_dames.txt 
La formule est sous FNC.
La formule est satisfiable en assignant 1 aux variables suivantes et 0 aux autres :
X_0_7
X_1_3
X_2_0
X_3_2
X_6_6
X_5_1
X_4_5
X_7_4
Temps d'ex§é§cution : 0.005287 s
    \end{lstlisting}
    Soit encore
    \begin{center}
        \begin{tabular}{| c || *{8}{c |}}
        \hline
          & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 \\
        \hline
        \hline
        0 &   &   & X &   &   &   &   &   \\
        \hline
        1 &   &   &   &   &   & X &   &   \\
        \hline
        2 &   &   &   & X &   &   &   &   \\
        \hline
        3 &   & X &   &   &   &   &   &   \\
        \hline
        4 &   &   &   &   &   &   &   & X \\
        \hline
        5 &   &   &   &   & X &   &   &   \\
        \hline
        6 &   &   &   &   &   &   & X &   \\
        \hline
        7 & X &   &   &   &   &   &   &   \\
        \hline
        \end{tabular}
    \end{center}
    
    Et pour le problème a 3 dames, on obtient
    \begin{lstlisting}
~/DM3$ satsolver/fnc_solver 3_dames.txt 
La formule est sous FNC.
La formule est insatisfiable.
Temps d'ex§é§cution : 0.000985 s
    \end{lstlisting}
    
    \section{Problème du calendrier}
    \subsection*{Description}
    Pour la résolution du problème du calendrier, il faut respecter ces deux règles:
    \begin{enumerate}
        \item Chaque case a une pièce (voir 0 pour certaine case).
        \item Chaque pièce n'est utiliser qu'une seul fois.
    \end{enumerate}
    
    Pour représenter le problème, chaque case aura 10 variables,
    indiquant si la pièce correspondante est dessus.
    
    Elle seront de la forme "$X$\_0\_0" avec $X$ le nom de la pièces,
    (0,0) les coordonnées de la cases.
    Exemples: "l\_4\_5", "T\_2\_7"
    
    (le nom des pièces sont : I, L, S, b, C, l, s, Z, T et V)
    
    Pour optimiser, les cases qui doivent avoir 0 pièce ne seront pas crée et utiliser.
    
    \subsubsection*{1. Contrainte d'une case}
    Pour $p_{i,j}$ les variables "p est en (i,j)" et $\bb{P}$ l'ensembles des pièces,
    la contrainte sur la case $(i,j)$ est
    \[F_{i,j} = \left(\bigvee_{p\in\bb{P}} p_{i,j} \right) \land
        \bigwedge_{\substack{(p,p')\in\bb{P}^2\\p<p'}}\left(\lnot p_{i,j} \lor \lnot p'_{i,j}\right)\]
    Cette formule est sous FNC.
    
    \subsubsection*{2. Contrainte de toutes les cases}
    Pour $C \subset \dsbracket{0,7}^2$ l'ensemble des cases qui doivent être remplie,
    la contrainte de toutes les cases est
    \[F = \bigwedge_{(i,j)\in C} \left(\left(\bigvee_{p\in\bb{P}} p_{i,j} \right) \land
        \bigwedge_{\substack{(p,p')\in\bb{P}^2\\p<p'}}\left(\lnot p_{i,j} \lor \lnot p'_{i,j}\right)\right)\]
    Cette formule est sous FNC.
    
    \subsubsection*{3. Contrainte d'une pièce}
    Pour $\bb{V}_p$ l'ensemble des positions valides de la pièce $p$,
    et
    \[N_v(p_{i,j}) = \begin{cases}
        p_{i,j} & \text{si $p$ dans la position $v$ est sur la case $(i,j)$}\\
        \lnot p_{i,j} & \text{sinon}
    \end{cases}\]
    
    Exemple pour la pièce $T$ de position $v =
    \begin{pmatrix}
        0 & 0 & 1 & 0 \\
        1 & 1 & 1 & 0 \\
        0 & 0 & 1 & 0 \\
        0 & 0 & 0 & 0 \\
    \end{pmatrix}$
    
    On a $N_v(T_{1,2}) = T_{1,2}$ et $N_v(T_{3,1}) = \lnot T_{3,1}$
    
    La contrainte d'une pièce $p$ est
    \[F_p = \bigvee_{v\in\bb{V}_p} \left( \bigwedge_{(i,j)\in C} N_v(p_{i,j}) \right)\]
    
    Mais cette formule n'est pas sous FNC,
    on doit passer par des variables intermédiaire que l'on nomme $Z_{p,v}$.
    \begin{align*}
        F_p &= \bigvee_{v\in\bb{V}_p} \left( \bigwedge_{(i,j)\in C} N_v(p_{i,j}) \right)\\
        &= \left( \bigvee_{v\in\bb{V}_p} Z_{p,v} \right)
            \land \bigwedge_{v\in\bb{V}_p} \left(Z_{p,v} \leftrightarrow \bigwedge_{(i,j)\in C} N_v(p_{i,j}) \right)\\
        &= \left( \bigvee_{v\in\bb{V}_p} Z_{p,v} \right)
            \land \bigwedge_{v\in\bb{V}_p} \left(Z_{p,v} \to \bigwedge_{(i,j)\in C} N_v(p_{i,j}) \right){}
            \land \bigwedge_{v\in\bb{V}_p} \left(\lnot Z_{p,v} \to \lnot\bigwedge_{(i,j)\in C} N_v(p_{i,j}) \right)\\
    \end{align*}
    Que l'on peut simplifié par
    \begin{align*}
        F_p &= \left( \bigvee_{v\in\bb{V}_p} Z_{p,v} \right)
            \land \bigwedge_{v\in\bb{V}_p} \left(Z_{p,v} \to \bigwedge_{(i,j)\in C} N_v(p_{i,j}) \right)\\
        &= \left( \bigvee_{v\in\bb{V}_p} Z_{p,v} \right)
            \land \bigwedge_{v\in\bb{V}_p} \left(\lnot Z_{p,v} \lor \bigwedge_{(i,j)\in C} N_v(p_{i,j}) \right)\\
        &= \left( \bigvee_{v\in\bb{V}_p} Z_{p,v} \right)
            \land \bigwedge_{\substack{(i,j)\in C\\v\in\bb{V}_p}} \left(\lnot Z_{p,v} \lor N_v(p_{i,j}) \right)\\
    \end{align*}
    qui est sous FNC.
    
    \subsubsection*{4. Contrainte de toutes les pièces}
    La contrainte de toutes les pièces est
    \[F = \bigwedge_{p\in\bb{P}} \left(\left( \bigvee_{v\in\bb{V}_p} Z_{p,v} \right) \land
        \bigwedge_{\substack{(i,j)\in C\\v\in\bb{V}_p}} \left(\lnot Z_{p,v} \lor N_v(p_{i,j}) \right)\right)\]
    Cette formule est sous FNC.
    
    \subsubsection*{5. Formule générale}
    La formule générale est donc
    \[F = \bigwedge_{(i,j)\in C} \left(\left(\bigvee_{p\in\bb{P}} p_{i,j} \right) \land
        \bigwedge_{\substack{(p,p')\in\bb{P}^2\\p<p'}}\left(\lnot p_{i,j} \lor \lnot p'_{i,j}\right)\right) \land
        \bigwedge_{p\in\bb{P}} \left(\left( \bigvee_{v\in\bb{V}_p} Z_{p,v} \right) \land
        \bigwedge_{\substack{(i,j)\in C\\v\in\bb{V}_p}} \left(\lnot Z_{p,v} \lor N_v(p_{i,j}) \right)\right)\]
    
    \subsection*{Implémentation}
    
\end{document}
